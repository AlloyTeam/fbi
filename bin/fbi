#!/usr/bin/env node

/*
 * fbi
 *
 * Copyright (c) 2015 Inman <neikvon@icloud.com>
 * Licensed under the MIT license.
 */

'use strict';

var fs = require('fs'),
  path = require('path'),
  inquirer = require('inquirer'),
  meow = require('meow'),
  pkg = require('../package.json'),
  task = require('../lib/task'),
  update = require('../lib/update'),
  tasksJson = require(path.join(__dirname, '../config/tasks'));

update.checkMain();

var cli = meow({
  help: false,
  pkg: pkg
});

var opts = cli.flags,
  args = cli.input,
  cmd = args[0];

// function start() {
//   var public_missions = [];
//   var choices;

//   for (var i = 0, len = tasksJson.missions.length; i < len; i++) {
//     if (!tasksJson.missions[i]['private']) {
//       public_missions.push(tasksJson.missions[i]);
//     }
//   }

//   choices = {
//     type: 'list',
//     name: 'cmd',
//     message: 'so ?',
//     choices: public_missions
//   };

//   inquirer.prompt(choices, function(answer) {
//     task.runTask(answer.cmd);
//     if (answer.whatNext === 'exit') return;
//   });
// }

if (!cmd || cmd === '') {
  cmd = 'h';
}
task.runTask(cmd);
    
// fs.access(path.join(__dirname, '../mission/node_modules'), fs.R_OK, function(err) {
//   if (err) {
//     inquirer.prompt({
//       type: "confirm",
//       name: "install",
//       message: "Install mission modules?",
//       default: true
//     }, function(answer) {
//       if (answer.install) {
//         task.installModules();
//       } else {
//         start();
//       }
//       if (answer.whatNext === 'exit') return;
//     });
//   } else {
//     if (!cmd || cmd === '') {
//       cmd = 'h';
//     }
//     task.runTask(cmd);
//     // if (cmd && cmd !== '') {
//     //   task.runTask(cmd);
//     // } else {
//     //   start();
//     // }
//   }
// });
